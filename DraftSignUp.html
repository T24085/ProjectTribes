<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Draft Sign-Up Sheet</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="oauth.js"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <style>
    body {
      background-image: url('https://github.com/T24085/images/blob/main/ss_fe25c58da0c50913fac070eea8150ee2e3cb178d.1920x1080.jpg?raw=true');
      background-size: cover;
      background-attachment: fixed;
      background-position: center;
      min-height: 100vh;
      margin: 0;
      font-family: 'Arial', sans-serif;
    }
    .glass-effect {
      background: rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
  </style>
</head>
<body class="text-white">
  <div id="root"></div>
  <script type="text/babel">
    const POSITIONS = ['HoF', 'LD', 'MD', 'MO', 'HO', 'LO', 'Capper'];

    // Initialize Firebase with the provided configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBIHMI4O-kqFmSeX6GxGTaU6UdaFTrJCF4",
      authDomain: "draftsignup-a1e16.firebaseapp.com",
      projectId: "draftsignup-a1e16",
      storageBucket: "draftsignup-a1e16.firebasestorage.app",
      messagingSenderId: "1059196886631",
      appId: "1:1059196886631:web:51340f4665a6b95f32fec2",
      measurementId: "G-YXXJVV1Q45"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const analytics = firebase.analytics();

    const App = () => {
      const [players, setPlayers] = React.useState([]);
      const [playerName, setPlayerName] = React.useState('');
      const [primaryRole, setPrimaryRole] = React.useState('');
      const [secondaryRole, setSecondaryRole] = React.useState('');
      const [loading, setLoading] = React.useState(true);
      const [user, setUser] = React.useState(null);
      const [adminEmail, setAdminEmail] = React.useState('');
      const [adminPassword, setAdminPassword] = React.useState('');
      const [showLogin, setShowLogin] = React.useState(false);
      const [loginError, setLoginError] = React.useState('');

      // Monitor auth state
      React.useEffect(() => {
        const unsubscribe = auth.onAuthStateChanged(user => {
          setUser(user);
        });
        return () => unsubscribe();
      }, []);

      // Fetch players from Firestore on component mount
      React.useEffect(() => {
        const fetchPlayers = async () => {
          try {
            const snapshot = await db.collection('players').get();
            const playersData = snapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
            setPlayers(playersData);
            setLoading(false);
          } catch (error) {
            console.error('Error fetching players:', error);
            alert('Failed to load players. Please try again.');
            setLoading(false);
          }
        };
        fetchPlayers();
      }, []);

      // Listen for real-time updates
      React.useEffect(() => {
        const unsubscribe = db.collection('players').onSnapshot(snapshot => {
          const playersData = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
          }));
          setPlayers(playersData);
        }, error => {
          console.error('Error listening for updates:', error);
        });
        return () => unsubscribe();
      }, []);

      const handleSignUp = async () => {
        if (!playerName.trim()) {
          alert('Please enter your name!');
          return;
        }
        if (!primaryRole) {
          alert('Please select a primary role!');
          return;
        }
        if (!secondaryRole) {
          alert('Please select a secondary role!');
          return;
        }
        if (primaryRole === secondaryRole) {
          alert('Primary and secondary roles cannot be the same!');
          return;
        }

        // Check for duplicate names in Firestore
        const nameLower = playerName.trim().toLowerCase();
        const querySnapshot = await db.collection('players')
          .where('nameLower', '==', nameLower)
          .get();
        
        if (!querySnapshot.empty) {
          alert('Player name already exists! Please use a different name.');
          return;
        }

        try {
          await db.collection('players').add({
            name: playerName.trim(),
            nameLower: nameLower,
            primaryRole,
            secondaryRole,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          });
          setPlayerName('');
          setPrimaryRole('');
          setSecondaryRole('');
          alert('Successfully signed up for the draft!');
        } catch (error) {
          console.error('Error signing up:', error);
          alert('Failed to sign up. Please try again.');
        }
      };

      const handleAdminLogin = async () => {
        try {
          setLoginError('');
          await auth.signInWithEmailAndPassword(adminEmail, adminPassword);
          setShowLogin(false);
          setAdminEmail('');
          setAdminPassword('');
        } catch (error) {
          console.error('Login error:', error);
          setLoginError('Invalid email or password. Please try again.');
        }
      };

      const handleAdminLogout = async () => {
        try {
          await auth.signOut();
        } catch (error) {
          console.error('Logout error:', error);
          alert('Failed to log out. Please try again.');
        }
      };

      const exportToCSV = () => {
        if (players.length === 0) {
          alert('No players to export!');
          return;
        }

        const headers = ['Name', 'Primary Role', 'Secondary Role'];
        const rows = players.map(player => [
          `"${player.name}"`,
          player.primaryRole,
          player.secondaryRole
        ]);

        const csvContent = [
          headers.join(','),
          ...rows.map(row => row.join(','))
        ].join('\n');

        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, 16);
        link.setAttribute('href', url);
        link.setAttribute('download', `draft-signups-${timestamp}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      };

      const clearSignUps = async () => {
        if (!user) {
          alert('You must be logged in as an admin to clear sign-ups.');
          return;
        }
        try {
          const batch = db.batch();
          const snapshot = await db.collection('players').get();
          snapshot.docs.forEach(doc => {
            batch.delete(doc.ref);
          });
          await batch.commit();
          setPlayers([]);
          alert('All sign-ups cleared!');
        } catch (error) {
          console.error('Error clearing sign-ups:', error);
          alert('Failed to clear sign-ups. Please try again.');
        }
      };

      if (loading) {
        return (
          <div className="container mx-auto p-4 text-center">
            <h1 className="text-4xl font-bold mb-8">Draft Sign-Up Sheet</h1>
            <p>Loading...</p>
          </div>
        );
      }

      return (
        <div className="container mx-auto p-4">
          <h1 className="text-4xl font-bold text-center mb-8">Draft Sign-Up Sheet</h1>

          {/* Admin Login/Logout Section */}
          <div className="glass-effect p-6 mb-8">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-2xl font-bold">Admin Controls</h2>
              {user ? (
                <button
                  onClick={handleAdminLogout}
                  className="bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded"
                >
                  Logout
                </button>
              ) : (
                <button
                  onClick={() => setShowLogin(!showLogin)}
                  className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded"
                >
                  {showLogin ? 'Cancel' : 'Admin Login'}
                </button>
              )}
            </div>
            {showLogin && !user && (
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <input
                  type="email"
                  placeholder="Admin Email"
                  value={adminEmail}
                  onChange={(e) => setAdminEmail(e.target.value)}
                  className="p-2 bg-gray-800 text-white rounded"
                />
                <input
                  type="password"
                  placeholder="Admin Password"
                  value={adminPassword}
                  onChange={(e) => setAdminPassword(e.target.value)}
                  className="p-2 bg-gray-800 text-white rounded"
                />
                <button
                  onClick={handleAdminLogin}
                  className="col-span-1 md:col-span-2 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"
                >
                  Login
                </button>
                {loginError && (
                  <p className="col-span-1 md:col-span-2 text-red-400 text-center">{loginError}</p>
                )}
              </div>
            )}
          </div>

          {/* Sign-Up Form */}
          <div className="glass-effect p-6 mb-8">
            <h2 className="text-2xl font-bold mb-4">Sign Up for the Draft</h2>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
              <input
                type="text"
                placeholder="Player Name"
                value={playerName}
                onChange={(e) => setPlayerName(e.target.value)}
                className="p-2 bg-gray-800 text-white rounded"
              />
              <select
                value={primaryRole}
                onChange={(e) => setPrimaryRole(e.target.value)}
                className="p-2 bg-gray-800 text-white rounded"
              >
                <option value="">Select Primary Role</option>
                {POSITIONS.map(pos => (
                  <option key={pos} value={pos}>{pos}</option>
                ))}
              </select>
              <select
                value={secondaryRole}
                onChange={(e) => setSecondaryRole(e.target.value)}
                className="p-2 bg-gray-800 text-white rounded"
                disabled={!primaryRole}
              >
                <option value="">Select Secondary Role</option>
                {POSITIONS
                  .filter(pos => pos !== primaryRole)
                  .map(pos => (
                    <option key={pos} value={pos}>{pos}</option>
                  ))}
              </select>
            </div>
            <button
              onClick={handleSignUp}
              className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-4"
            >
              Sign Up
            </button>
          </div>

          {/* Display Sign-Ups */}
          {players.length > 0 && (
            <div className="glass-effect p-6 mb-8">
              <h2 className="text-2xl font-bold mb-4">Registered Players ({players.length})</h2>
              <div className="overflow-x-auto">
                <table className="w-full text-left border-collapse">
                  <thead>
                    <tr>
                      <th className="p-2 border-b border-gray-600">Name</th>
                      <th className="p-2 border-b border-gray-600">Primary Role</th>
                      <th className="p-2 border-b border-gray-600">Secondary Role</th>
                    </tr>
                  </thead>
                  <tbody>
                    {players.map(player => (
                      <tr key={player.id} className="hover:bg-gray-700">
                        <td className="p-2 border-b border-gray-600">{player.name}</td>
                        <td className="p-2 border-b border-gray-600">{player.primaryRole}</td>
                        <td className="p-2 border-b border-gray-600">{player.secondaryRole}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
              <div className="flex justify-between mt-4">
                <button
                  onClick={exportToCSV}
                  className="bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded"
                >
                  Export to CSV
                </button>
                <button
                  onClick={clearSignUps}
                  className={`bg-red-600 text-white font-bold py-2 px-4 rounded ${!user ? 'opacity-50 cursor-not-allowed' : 'hover:bg-red-700'}`}
                  disabled={!user}
                  title={!user ? 'Admin login required to clear sign-ups' : ''}
                >
                  Clear Sign-Ups
                </button>
              </div>
            </div>
          )}
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>