<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create a Team</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="oauth.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen">
  <div id="nav-placeholder"></div>
  <script>
    fetch('nav.html').then(r=>r.text()).then(html=>{
      document.getElementById('nav-placeholder').innerHTML = html;
      if (window.twitchOAuth) {
        twitchOAuth.updateNav();
        twitchOAuth.initLiveTeamsMenu();
      }
    });
  </script>

  <main class="container mx-auto p-4">
    <h1 class="text-3xl font-bold mb-4 text-center">Create a Team</h1>
    <form id="team-form" class="space-y-4 max-w-xl mx-auto">
      <input id="team-name" type="text" placeholder="Team name" class="w-full p-2 rounded bg-gray-800" required>
      <label class="block">Logo image
        <input id="team-logo" type="file" accept="image/*" class="mt-1">
      </label>
      <label class="block">Banner image
        <input id="team-banner" type="file" accept="image/*" class="mt-1">
      </label>
      <button type="submit" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">Save Team</button>
    </form>

    <section id="team-list" class="mt-8 space-y-8"></section>
  </main>

  <script>
  function dataUrlFromFile(file) {
    return new Promise(res=>{
      if(!file) return res('');
      const reader = new FileReader();
      reader.onload = () => res(reader.result);
      reader.readAsDataURL(file);
    });
  }

  async function loadTeams() {
    const list = document.getElementById('team-list');
    const teams = await fetch('/api/teams').then(r=>r.json());
    list.innerHTML = '';
    teams.forEach(team => {
      const div = document.createElement('div');
      div.className = 'bg-gray-800 p-4 rounded';
      div.innerHTML = `
        <h2 class="text-xl font-semibold mb-2">${team.name}</h2>
        ${team.banner ? `<img src="${team.banner}" alt="banner" class="w-full mb-2">` : ''}
        ${team.logo ? `<img src="${team.logo}" alt="logo" class="w-24 h-24 mb-2">` : ''}
      `;
      list.appendChild(div);
    });
  }

  document.getElementById('team-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('team-name').value.trim();
    const logoFile = document.getElementById('team-logo').files[0];
    const bannerFile = document.getElementById('team-banner').files[0];
    const logoData = await dataUrlFromFile(logoFile);
    const bannerData = await dataUrlFromFile(bannerFile);

    await fetch('/api/teams', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({name, logo: logoData, banner: bannerData})
    });
    loadTeams();
    e.target.reset();
  });

  document.addEventListener('DOMContentLoaded', loadTeams);
  </script>
</body>
</html>
